<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
  <title>Geometric shapes example</title>
</head>

<body>
  <script type="application/javascript" src="../lib/agent.js"></script>
  <script>
    const vshr = `
      attribute vec2 aPos;
			attribute vec2 aText;
      uniform mat4 camera;

			varying vec2 vTexture;

      void main() {
				vTexture = aText;
        gl_Position = camera * vec4(aPos, 0.0, 1.0);
      }
    `;
    const fshr = `
      precision mediump float;

			uniform sampler2D uSampler;
			varying vec2 vTexture;

      void main() {
        gl_FragColor = texture2D(uSampler, vTexture);
      }
		`;

		let engine = new Agent.Engine({width: 1200, height: 800});
		let square = new Agent.Square(10, 100, 128, 328);
		let square2 = new Agent.Square(200, 100, 128, 128);
		let camera = new Agent.OrthographicCamera({left:0, right:1200, top:0, bottom:800, far:0, near:100});

		let scene = engine.newScene('worldScene');
		let brickTexture = engine.newTexture();
		let fireTexture = engine.newTexture();

		fireTexture.loadResource("./images/firetexture.png")
			.then((success) => {
				square.setTexture(fireTexture); // assign our texture to a renderable
				engine.render();					// re-render since we are not running in a loop
			})
			.catch((success) => {
				console.log('fire texture failed to load');
			});

		brickTexture.loadResource("./images/bricktexture.png")
			.then((success) => {
				square2.setTexture(brickTexture);  // assign our texture to a renderable
				engine.render();            // re-render since we are not running in a loop
			})
			.catch((success) => {
				console.log('brick texture failed to load');
			});

			scene.addShader(Agent.ShaderType.Vertex, vshr);
			scene.addShader(Agent.ShaderType.Fragment, fshr);

			scene.shader(Agent.ShaderType.Vertex).setUniformDataFor('camera', { dataMatrix: camera.matrix() });
			scene.shader(Agent.ShaderType.Vertex).setAttributeDataFor('aPos', { vertexAttribute: square.vertexAttributes() });
			scene.shader(Agent.ShaderType.Vertex).setAttributeDataFor('aText', { vertexAttribute: square.textureAttributes() });

			scene.shader(Agent.ShaderType.Vertex).setAttributeDataFor('aPos', { vertexAttribute: square2.vertexAttributes() });
			scene.shader(Agent.ShaderType.Vertex).setAttributeDataFor('aText', { vertexAttribute: square2.textureAttributes() });

			scene.addDrawable(square, square2);
			scene.addCamera(camera);
			engine.render();
  </script>
</body>
</html>
